## 异常处理机制

### 1. 大模型调用异常

- **场景描述**：API 调用超时、返回错误码、内容生成失败
- **处理策略**：
  - 指数退避重试：首次延迟 1s，后续指数级增加至最大 30s
  - 最大重试次数：3 次
  - 降级方案：调用失败后自动切换至备用模型
- **监控告警**：连续失败 5 次触发一级告警，通知技术负责人

### 2. 素材处理异常

- **场景描述**：文件损坏、格式不支持、上传中断
- **处理策略**：
  - 异步任务队列：素材处理放入独立队列，避免阻塞主流程
  - 状态回调：处理结果通过 WebSocket 实时通知前端
  - 失败处理：保留原始文件，提供手动重试入口
- **用户提示**：明确错误原因与解决方案，如"文件格式不支持，请上传 jpg/png 格式"

### 3. 发布流程异常

- **场景描述**：渠道 API 故障、认证失败、内容格式错误
- **处理策略**：
  - 自动重试：间隔 5 分钟，最多重试 2 次
  - 任务隔离：单个渠道失败不影响其他渠道发布
  - 人工干预：重试失败后标记为"需人工处理"，提供编辑修复入口
- **数据一致性**：发布状态实时同步，部分失败时支持单独重试

### 4. 数据库操作异常

- **场景描述**：连接超时、死锁、数据约束冲突
- **处理策略**：
  - 事务回滚：关键操作使用事务保证原子性
  - 乐观锁：并发更新冲突时自动重试
  - 读写分离：读操作失败时自动切换备用从库
- **数据恢复**：定期备份+binlog 日志，支持时间点恢复

### 5. 前端交互异常

- **场景描述**：网络中断、请求超时、数据格式错误
- **处理策略**：
  - 请求缓存：关键数据本地缓存，网络恢复后同步
  - 优雅降级：功能不可用时显示友好提示而非错误堆栈
  - 操作防抖：避免重复提交，按钮点击后置灰禁用
- **错误监控**：前端错误日志上报至监控系统，定期分析优化
